(()=>{"use strict";let e;function t(t){return n=this,o=void 0,r=function*(){const n=chrome.runtime.getURL(t);(yield chrome.runtime.getContexts({contextTypes:[chrome.runtime.ContextType.OFFSCREEN_DOCUMENT],documentUrls:[n]})).length>0||(e?yield e:(e=chrome.offscreen.createDocument({url:t,reasons:[chrome.offscreen.Reason.AUDIO_PLAYBACK,chrome.offscreen.Reason.LOCAL_STORAGE],justification:"play text to speech audio file"}),yield e,e=null))},new((c=void 0)||(c=Promise))((function(e,t){function i(e){try{a(r.next(e))}catch(e){t(e)}}function s(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof c?n:new c((function(e){e(n)}))).then(i,s)}a((r=r.apply(n,o||[])).next())}));var n,o,c,r}var n=function(e,t,n,o){return new(n||(n=Promise))((function(c,r){function i(e){try{a(o.next(e))}catch(e){r(e)}}function s(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}a((o=o.apply(e,t||[])).next())}))};function o(){return n(this,void 0,void 0,(function*(){yield t("offScreen/off-screen.html"),chrome.tabs.query({active:!0,currentWindow:!0},(e=>n(this,void 0,void 0,(function*(){if(!e||0===e.length||!e[0].id)return;const t=e[0].id,n=yield chrome.storage.sync.get({voiceName:"en-US-ChristopherNeural",customVoice:"",speed:1.2});chrome.scripting.executeScript({target:{tabId:t},func:()=>document.body.innerText}).then((e=>{if(e&&e.length>0&&e[0].result){const t=e[0].result;console.log("page content :",t),chrome.runtime.sendMessage({type:"readText",target:"offscreen",data:t,settings:n})}}))}))))}))}chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"readAloud",title:"Read Aloud with Edge TTS",contexts:["selection"]}),chrome.contextMenus.create({id:"readPage",title:"Read Page Aloud with Edge TTS",contexts:["page"]})})),chrome.contextMenus.onClicked.addListener(((e,c)=>n(void 0,void 0,void 0,(function*(){if(!c.id)return void console.error("Tab Not Found.");const n=yield chrome.storage.sync.get({voiceName:"en-US-ChristopherNeural",customVoice:"",speed:1.2});"readAloud"===e.menuItemId&&e.selectionText?(yield t("offScreen/off-screen.html"),chrome.runtime.sendMessage({type:"readText",target:"offscreen",data:e.selectionText,settings:n})):"readPage"===e.menuItemId&&void 0!==(null==c?void 0:c.id)&&o()})))),chrome.commands.onCommand.addListener((e=>n(void 0,void 0,void 0,(function*(){if("read-selected-text"===e){yield t("offScreen/off-screen.html");const e=yield chrome.storage.sync.get({voiceName:"en-US-ChristopherNeural",customVoice:"",speed:1.2});chrome.tabs.query({active:!0,currentWindow:!0},(t=>{if(!t||0===t.length||!t[0].id)return;const n=t[0].id;chrome.scripting.executeScript({target:{tabId:n},func:()=>window.getSelection().toString()}).then((t=>{if(t&&t.length>0&&t[0].result){const n=t[0].result;console.log("Selected text:",n),chrome.runtime.sendMessage({type:"readText",target:"offscreen",data:n,settings:e})}else console.warn("No text selected.")})).catch((e=>console.error("Error executing script:",e)))}))}})))),chrome.runtime.onMessage.addListener(((e,t,c)=>n(void 0,void 0,void 0,(function*(){"offscreen:readPage"===e.action?o():"offscreen:togglePause"===e.action?chrome.runtime.sendMessage({type:"togglePause",target:"offscreen",isPaused:e.isPaused}):"offscreen:stopPlayback"===e.action&&(console.log("Stopping playback and removing control panel."),chrome.runtime.sendMessage({type:"stopPlayback",target:"offscreen"}))})))),chrome.runtime.onMessage.addListener(((e,t,o)=>n(void 0,void 0,void 0,(function*(){chrome.tabs.query({active:!0,currentWindow:!0},(t=>{if(!t||0===t.length||!t[0].id)return void console.error("No active tab found.");const n=t[0].id;"controlPanel:remove"===e.action?chrome.tabs.sendMessage(n,{action:"controlPanel:remove"}):"controlPanel:create"===e.action?chrome.tabs.sendMessage(n,{action:"controlPanel:create"}):"controlPanel:updateLoading"===e.action&&chrome.tabs.sendMessage(n,{action:"controlPanel:updateLoading",isLoading:e.isLoading})}))}))))})();